import { validateEvents as validateEventsWithoutLog, } from 'calendar-utils';
export const validateEvents = (events) => {
    const warn = (...args) => console.warn('angular-calendar', ...args);
    return validateEventsWithoutLog(events, warn);
};
export function isInsideLeftAndRight(outer, inner) {
    return (Math.floor(outer.left) <= Math.ceil(inner.left) &&
        Math.floor(inner.left) <= Math.ceil(outer.right) &&
        Math.floor(outer.left) <= Math.ceil(inner.right) &&
        Math.floor(inner.right) <= Math.ceil(outer.right));
}
function isInsideTopAndBottom(outer, inner) {
    return (Math.floor(outer.top) <= Math.ceil(inner.top) &&
        Math.floor(inner.top) <= Math.ceil(outer.bottom) &&
        Math.floor(outer.top) <= Math.ceil(inner.bottom) &&
        Math.floor(inner.bottom) <= Math.ceil(outer.bottom));
}
export function isInside(outer, inner) {
    return (isInsideLeftAndRight(outer, inner) && isInsideTopAndBottom(outer, inner));
}
export function roundToNearest(amount, precision) {
    return Math.round(amount / precision) * precision;
}
export const trackByEventId = (index, event) => event.id ? event.id : event;
export const trackByWeekDayHeaderDate = (index, day) => day.date.toISOString();
export const trackByHourSegment = (index, segment) => segment.date.toISOString();
export const trackByHour = (index, hour) => hour.segments[0].date.toISOString();
export const trackByWeekAllDayEvent = (index, weekEvent) => (weekEvent.event.id ? weekEvent.event.id : weekEvent.event);
export const trackByWeekTimeEvent = (index, weekEvent) => (weekEvent.event.id ? weekEvent.event.id : weekEvent.event);
const MINUTES_IN_HOUR = 60;
function getPixelAmountInMinutes(hourSegments, hourSegmentHeight, hourDuration) {
    return (hourDuration || MINUTES_IN_HOUR) / (hourSegments * hourSegmentHeight);
}
export function getMinutesMoved(movedY, hourSegments, hourSegmentHeight, eventSnapSize, hourDuration) {
    const draggedInPixelsSnapSize = roundToNearest(movedY, eventSnapSize || hourSegmentHeight);
    const pixelAmountInMinutes = getPixelAmountInMinutes(hourSegments, hourSegmentHeight, hourDuration);
    return draggedInPixelsSnapSize * pixelAmountInMinutes;
}
export function getDefaultEventEnd(dateAdapter, event, minimumMinutes) {
    if (event.end) {
        return event.end;
    }
    else {
        return dateAdapter.addMinutes(event.start, minimumMinutes);
    }
}
export function addDaysWithExclusions(dateAdapter, date, days, excluded) {
    let daysCounter = 0;
    let daysToAdd = 0;
    const changeDays = days < 0 ? dateAdapter.subDays : dateAdapter.addDays;
    let result = date;
    while (daysToAdd <= Math.abs(days)) {
        result = changeDays(date, daysCounter);
        const day = dateAdapter.getDay(result);
        if (excluded.indexOf(day) === -1) {
            daysToAdd++;
        }
        daysCounter++;
    }
    return result;
}
export function isDraggedWithinPeriod(newStart, newEnd, period) {
    const end = newEnd || newStart;
    return ((period.start <= newStart && newStart <= period.end) ||
        (period.start <= end && end <= period.end));
}
export function shouldFireDroppedEvent(dropEvent, date, allDay, calendarId) {
    return (dropEvent.dropData &&
        dropEvent.dropData.event &&
        (dropEvent.dropData.calendarId !== calendarId ||
            (dropEvent.dropData.event.allDay && !allDay) ||
            (!dropEvent.dropData.event.allDay && allDay)));
}
export function getWeekViewPeriod(dateAdapter, viewDate, weekStartsOn, excluded = [], daysInWeek) {
    let viewStart = daysInWeek
        ? dateAdapter.startOfDay(viewDate)
        : dateAdapter.startOfWeek(viewDate, { weekStartsOn });
    const endOfWeek = dateAdapter.endOfWeek(viewDate, { weekStartsOn });
    while (excluded.indexOf(dateAdapter.getDay(viewStart)) > -1 &&
        viewStart < endOfWeek) {
        viewStart = dateAdapter.addDays(viewStart, 1);
    }
    if (daysInWeek) {
        const viewEnd = dateAdapter.endOfDay(addDaysWithExclusions(dateAdapter, viewStart, daysInWeek - 1, excluded));
        return { viewStart, viewEnd };
    }
    else {
        let viewEnd = endOfWeek;
        while (excluded.indexOf(dateAdapter.getDay(viewEnd)) > -1 &&
            viewEnd > viewStart) {
            viewEnd = dateAdapter.subDays(viewEnd, 1);
        }
        return { viewStart, viewEnd };
    }
}
export function isWithinThreshold({ x, y }) {
    const DRAG_THRESHOLD = 1;
    return Math.abs(x) > DRAG_THRESHOLD || Math.abs(y) > DRAG_THRESHOLD;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYi9tb2R1bGVzL2NvbW1vbi90ZW1wL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUtILGNBQWMsSUFBSSx3QkFBd0IsR0FJM0MsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QixNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxNQUF1QixFQUFFLEVBQUU7SUFDeEQsTUFBTSxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQ3BFLE9BQU8sd0JBQXdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ2hELENBQUMsQ0FBQztBQUVGLE1BQU0sVUFBVSxvQkFBb0IsQ0FDbEMsS0FBaUIsRUFDakIsS0FBaUI7SUFFakIsT0FBTyxDQUNMLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUMvQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDaEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ2hELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUNsRCxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsb0JBQW9CLENBQUMsS0FBaUIsRUFBRSxLQUFpQjtJQUNoRSxPQUFPLENBQ0ws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QztJQUNwRSxPQUNFLFFBQVEsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwRCxTQUFTLEdBQUcsU0FBUyxFQUNyQjtRQUNBLFNBQVMsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMvQztJQUNELElBQUksVUFBVSxFQUFFO1FBQ2QsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FDbEMscUJBQXFCLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUcsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUN4RSxDQUFDO1FBQ0YsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsQ0FBQztLQUMvQjtTQUFNO1FBQ0wsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDO1FBQ3hCLE9BQ0UsUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xELE9BQU8sR0FBRyxTQUFTLEVBQ25CO1lBQ0EsT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQzNDO1FBQ0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsQ0FBQztLQUMvQjtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUE0QjtJQUNsRSxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUM7SUFDekIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLGNBQWMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLGNBQWMsQ0FBQztBQUN0RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZUFkYXB0ZXIgfSBmcm9tICdhbmd1bGFyLWNhbGVuZGFyJztcclxuaW1wb3J0IHtcclxuICAgIENhbGVuZGFyRXZlbnQsXHJcbiAgICBXZWVrVmlld1RpbWVFdmVudCxcclxuICAgIFdlZWtWaWV3SG91cixcclxuICAgIFdlZWtWaWV3SG91clNlZ21lbnQsXHJcbiAgICB2YWxpZGF0ZUV2ZW50cyBhcyB2YWxpZGF0ZUV2ZW50c1dpdGhvdXRMb2csXHJcbiAgICBWaWV3UGVyaW9kLFxyXG4gICAgV2Vla0RheSxcclxuICAgIFdlZWtWaWV3QWxsRGF5RXZlbnQsXHJcbiAgfSBmcm9tICdjYWxlbmRhci11dGlscyc7XHJcbiAgXHJcbiAgZXhwb3J0IGNvbnN0IHZhbGlkYXRlRXZlbnRzID0gKGV2ZW50czogQ2FsZW5kYXJFdmVudFtdKSA9PiB7XHJcbiAgICBjb25zdCB3YXJuID0gKC4uLmFyZ3MpID0+IGNvbnNvbGUud2FybignYW5ndWxhci1jYWxlbmRhcicsIC4uLmFyZ3MpO1xyXG4gICAgcmV0dXJuIHZhbGlkYXRlRXZlbnRzV2l0aG91dExvZyhldmVudHMsIHdhcm4pO1xyXG4gIH07XHJcbiAgXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGlzSW5zaWRlTGVmdEFuZFJpZ2h0KFxyXG4gICAgb3V0ZXI6IENsaWVudFJlY3QsXHJcbiAgICBpbm5lcjogQ2xpZW50UmVjdFxyXG4gICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgTWF0aC5mbG9vcihvdXRlci5sZWZ0KSA8PSBNYXRoLmNlaWwoaW5uZXIubGVmdCkgJiZcclxuICAgICAgTWF0aC5mbG9vcihpbm5lci5sZWZ0KSA8PSBNYXRoLmNlaWwob3V0ZXIucmlnaHQpICYmXHJcbiAgICAgIE1hdGguZmxvb3Iob3V0ZXIubGVmdCkgPD0gTWF0aC5jZWlsKGlubmVyLnJpZ2h0KSAmJlxyXG4gICAgICBNYXRoLmZsb29yKGlubmVyLnJpZ2h0KSA8PSBNYXRoLmNlaWwob3V0ZXIucmlnaHQpXHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICBmdW5jdGlvbiBpc0luc2lkZVRvcEFuZEJvdHRvbShvdXRlcjogQ2xpZW50UmVjdCwgaW5uZXI6IENsaWVudFJlY3QpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIE1hdGguZmxvb3Iob3V0ZXIudG9wKSA8PSBNYXRoLmNlaWwoaW5uZXIudG9wKSAmJlxyXG4gICAgICBNYXRoLmZsb29yKGlubmVyLnRvcCkgPD0gTWF0aC5jZWlsKG91dGVyLmJvdHRvbSkgJiZcclxuICAgICAgTWF0aC5mbG9vcihvdXRlci50b3ApIDw9IE1hdGguY2VpbChpbm5lci5ib3R0b20pICYmXHJcbiAgICAgIE1hdGguZmxvb3IoaW5uZXIuYm90dG9tKSA8PSBNYXRoLmNlaWwob3V0ZXIuYm90dG9tKVxyXG4gICAgKTtcclxuICB9XHJcbiAgXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGlzSW5zaWRlKG91dGVyOiBDbGllbnRSZWN0LCBpbm5lcjogQ2xpZW50UmVjdCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgaXNJbnNpZGVMZWZ0QW5kUmlnaHQob3V0ZXIsIGlubmVyKSAmJiBpc0luc2lkZVRvcEFuZEJvdHRvbShvdXRlciwgaW5uZXIpXHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gcm91bmRUb05lYXJlc3QoYW1vdW50OiBudW1iZXIsIHByZWNpc2lvbjogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5yb3VuZChhbW91bnQgLyBwcmVjaXNpb24pICogcHJlY2lzaW9uO1xyXG4gIH1cclxuICBcclxuICBleHBvcnQgY29uc3QgdHJhY2tCeUV2ZW50SWQgPSAoaW5kZXg6IG51bWJlciwgZXZlbnQ6IENhbGVuZGFyRXZlbnQpID0+XHJcbiAgICBldmVudC5pZCA/IGV2ZW50LmlkIDogZXZlbnQ7XHJcbiAgXHJcbiAgZXhwb3J0IGNvbnN0IHRyYWNrQnlXZWVrRGF5SGVhZGVyRGF0ZSA9IChpbmRleDogbnVtYmVyLCBkYXk6IFdlZWtEYXkpID0+XHJcbiAgICBkYXkuZGF0ZS50b0lTT1N0cmluZygpO1xyXG4gIFxyXG4gIGV4cG9ydCBjb25zdCB0cmFja0J5SG91clNlZ21lbnQgPSAoXHJcbiAgICBpbmRleDogbnVtYmVyLFxyXG4gICAgc2VnbWVudDogV2Vla1ZpZXdIb3VyU2VnbWVudFxyXG4gICkgPT4gc2VnbWVudC5kYXRlLnRvSVNPU3RyaW5nKCk7XHJcbiAgXHJcbiAgZXhwb3J0IGNvbnN0IHRyYWNrQnlIb3VyID0gKGluZGV4OiBudW1iZXIsIGhvdXI6IFdlZWtWaWV3SG91cikgPT5cclxuICAgIGhvdXIuc2VnbWVudHNbMF0uZGF0ZS50b0lTT1N0cmluZygpO1xyXG4gIFxyXG4gIGV4cG9ydCBjb25zdCB0cmFja0J5V2Vla0FsbERheUV2ZW50ID0gKFxyXG4gICAgaW5kZXg6IG51bWJlcixcclxuICAgIHdlZWtFdmVudDogV2Vla1ZpZXdBbGxEYXlFdmVudFxyXG4gICkgPT4gKHdlZWtFdmVudC5ldmVudC5pZCA/IHdlZWtFdmVudC5ldmVudC5pZCA6IHdlZWtFdmVudC5ldmVudCk7XHJcbiAgXHJcbiAgZXhwb3J0IGNvbnN0IHRyYWNrQnlXZWVrVGltZUV2ZW50ID0gKFxyXG4gICAgaW5kZXg6IG51bWJlcixcclxuICAgIHdlZWtFdmVudDogV2Vla1ZpZXdUaW1lRXZlbnRcclxuICApID0+ICh3ZWVrRXZlbnQuZXZlbnQuaWQgPyB3ZWVrRXZlbnQuZXZlbnQuaWQgOiB3ZWVrRXZlbnQuZXZlbnQpO1xyXG4gIFxyXG4gIGNvbnN0IE1JTlVURVNfSU5fSE9VUiA9IDYwO1xyXG4gIFxyXG4gIGZ1bmN0aW9uIGdldFBpeGVsQW1vdW50SW5NaW51dGVzKFxyXG4gICAgaG91clNlZ21lbnRzOiBudW1iZXIsXHJcbiAgICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyLFxyXG4gICAgaG91ckR1cmF0aW9uPzogbnVtYmVyXHJcbiAgKSB7XHJcbiAgICByZXR1cm4gKGhvdXJEdXJhdGlvbiB8fCBNSU5VVEVTX0lOX0hPVVIpIC8gKGhvdXJTZWdtZW50cyAqIGhvdXJTZWdtZW50SGVpZ2h0KTtcclxuICB9XHJcbiAgXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGdldE1pbnV0ZXNNb3ZlZChcclxuICAgIG1vdmVkWTogbnVtYmVyLFxyXG4gICAgaG91clNlZ21lbnRzOiBudW1iZXIsXHJcbiAgICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyLFxyXG4gICAgZXZlbnRTbmFwU2l6ZTogbnVtYmVyLFxyXG4gICAgaG91ckR1cmF0aW9uPzogbnVtYmVyXHJcbiAgKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGRyYWdnZWRJblBpeGVsc1NuYXBTaXplID0gcm91bmRUb05lYXJlc3QoXHJcbiAgICAgIG1vdmVkWSxcclxuICAgICAgZXZlbnRTbmFwU2l6ZSB8fCBob3VyU2VnbWVudEhlaWdodFxyXG4gICAgKTtcclxuICAgIGNvbnN0IHBpeGVsQW1vdW50SW5NaW51dGVzID0gZ2V0UGl4ZWxBbW91bnRJbk1pbnV0ZXMoXHJcbiAgICAgIGhvdXJTZWdtZW50cyxcclxuICAgICAgaG91clNlZ21lbnRIZWlnaHQsXHJcbiAgICAgIGhvdXJEdXJhdGlvblxyXG4gICAgKTtcclxuICAgIHJldHVybiBkcmFnZ2VkSW5QaXhlbHNTbmFwU2l6ZSAqIHBpeGVsQW1vdW50SW5NaW51dGVzO1xyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdEV2ZW50RW5kKFxyXG4gICAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gICAgZXZlbnQ6IENhbGVuZGFyRXZlbnQsXHJcbiAgICBtaW5pbXVtTWludXRlczogbnVtYmVyXHJcbiAgKTogRGF0ZSB7XHJcbiAgICBpZiAoZXZlbnQuZW5kKSB7XHJcbiAgICAgIHJldHVybiBldmVudC5lbmQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZGF0ZUFkYXB0ZXIuYWRkTWludXRlcyhldmVudC5zdGFydCwgbWluaW11bU1pbnV0ZXMpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gYWRkRGF5c1dpdGhFeGNsdXNpb25zKFxyXG4gICAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gICAgZGF0ZTogRGF0ZSxcclxuICAgIGRheXM6IG51bWJlcixcclxuICAgIGV4Y2x1ZGVkOiBudW1iZXJbXVxyXG4gICk6IERhdGUge1xyXG4gICAgbGV0IGRheXNDb3VudGVyID0gMDtcclxuICAgIGxldCBkYXlzVG9BZGQgPSAwO1xyXG4gICAgY29uc3QgY2hhbmdlRGF5cyA9IGRheXMgPCAwID8gZGF0ZUFkYXB0ZXIuc3ViRGF5cyA6IGRhdGVBZGFwdGVyLmFkZERheXM7XHJcbiAgICBsZXQgcmVzdWx0ID0gZGF0ZTtcclxuICAgIHdoaWxlIChkYXlzVG9BZGQgPD0gTWF0aC5hYnMoZGF5cykpIHtcclxuICAgICAgcmVzdWx0ID0gY2hhbmdlRGF5cyhkYXRlLCBkYXlzQ291bnRlcik7XHJcbiAgICAgIGNvbnN0IGRheSA9IGRhdGVBZGFwdGVyLmdldERheShyZXN1bHQpO1xyXG4gICAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihkYXkpID09PSAtMSkge1xyXG4gICAgICAgIGRheXNUb0FkZCsrO1xyXG4gICAgICB9XHJcbiAgICAgIGRheXNDb3VudGVyKys7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gaXNEcmFnZ2VkV2l0aGluUGVyaW9kKFxyXG4gICAgbmV3U3RhcnQ6IERhdGUsXHJcbiAgICBuZXdFbmQ6IERhdGUsXHJcbiAgICBwZXJpb2Q6IFZpZXdQZXJpb2RcclxuICApOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGVuZCA9IG5ld0VuZCB8fCBuZXdTdGFydDtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIChwZXJpb2Quc3RhcnQgPD0gbmV3U3RhcnQgJiYgbmV3U3RhcnQgPD0gcGVyaW9kLmVuZCkgfHxcclxuICAgICAgKHBlcmlvZC5zdGFydCA8PSBlbmQgJiYgZW5kIDw9IHBlcmlvZC5lbmQpXHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gc2hvdWxkRmlyZURyb3BwZWRFdmVudChcclxuICAgIGRyb3BFdmVudDogeyBkcm9wRGF0YT86IHsgZXZlbnQ/OiBDYWxlbmRhckV2ZW50OyBjYWxlbmRhcklkPzogc3ltYm9sIH0gfSxcclxuICAgIGRhdGU6IERhdGUsXHJcbiAgICBhbGxEYXk6IGJvb2xlYW4sXHJcbiAgICBjYWxlbmRhcklkOiBzeW1ib2xcclxuICApIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIGRyb3BFdmVudC5kcm9wRGF0YSAmJlxyXG4gICAgICBkcm9wRXZlbnQuZHJvcERhdGEuZXZlbnQgJiZcclxuICAgICAgKGRyb3BFdmVudC5kcm9wRGF0YS5jYWxlbmRhcklkICE9PSBjYWxlbmRhcklkIHx8XHJcbiAgICAgICAgKGRyb3BFdmVudC5kcm9wRGF0YS5ldmVudC5hbGxEYXkgJiYgIWFsbERheSkgfHxcclxuICAgICAgICAoIWRyb3BFdmVudC5kcm9wRGF0YS5ldmVudC5hbGxEYXkgJiYgYWxsRGF5KSlcclxuICAgICk7XHJcbiAgfVxyXG4gIFxyXG4gIGV4cG9ydCBmdW5jdGlvbiBnZXRXZWVrVmlld1BlcmlvZChcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICAgIHZpZXdEYXRlOiBEYXRlLFxyXG4gICAgd2Vla1N0YXJ0c09uOiBudW1iZXIsXHJcbiAgICBleGNsdWRlZDogbnVtYmVyW10gPSBbXSxcclxuICAgIGRheXNJbldlZWs/OiBudW1iZXJcclxuICApOiB7IHZpZXdTdGFydDogRGF0ZTsgdmlld0VuZDogRGF0ZSB9IHtcclxuICAgIGxldCB2aWV3U3RhcnQgPSBkYXlzSW5XZWVrXHJcbiAgICAgID8gZGF0ZUFkYXB0ZXIuc3RhcnRPZkRheSh2aWV3RGF0ZSlcclxuICAgICAgOiBkYXRlQWRhcHRlci5zdGFydE9mV2Vlayh2aWV3RGF0ZSwgeyB3ZWVrU3RhcnRzT24gfSk7XHJcbiAgICBjb25zdCBlbmRPZldlZWsgPSBkYXRlQWRhcHRlci5lbmRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uIH0pO1xyXG4gICAgd2hpbGUgKFxyXG4gICAgICBleGNsdWRlZC5pbmRleE9mKGRhdGVBZGFwdGVyLmdldERheSh2aWV3U3RhcnQpKSA+IC0xICYmXHJcbiAgICAgIHZpZXdTdGFydCA8IGVuZE9mV2Vla1xyXG4gICAgKSB7XHJcbiAgICAgIHZpZXdTdGFydCA9IGRhdGVBZGFwdGVyLmFkZERheXModmlld1N0YXJ0LCAxKTtcclxuICAgIH1cclxuICAgIGlmIChkYXlzSW5XZWVrKSB7XHJcbiAgICAgIGNvbnN0IHZpZXdFbmQgPSBkYXRlQWRhcHRlci5lbmRPZkRheShcclxuICAgICAgICBhZGREYXlzV2l0aEV4Y2x1c2lvbnMoZGF0ZUFkYXB0ZXIsIHZpZXdTdGFydCwgZGF5c0luV2VlayAtIDEsIGV4Y2x1ZGVkKVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4geyB2aWV3U3RhcnQsIHZpZXdFbmQgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCB2aWV3RW5kID0gZW5kT2ZXZWVrO1xyXG4gICAgICB3aGlsZSAoXHJcbiAgICAgICAgZXhjbHVkZWQuaW5kZXhPZihkYXRlQWRhcHRlci5nZXREYXkodmlld0VuZCkpID4gLTEgJiZcclxuICAgICAgICB2aWV3RW5kID4gdmlld1N0YXJ0XHJcbiAgICAgICkge1xyXG4gICAgICAgIHZpZXdFbmQgPSBkYXRlQWRhcHRlci5zdWJEYXlzKHZpZXdFbmQsIDEpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHZpZXdTdGFydCwgdmlld0VuZCB9O1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBleHBvcnQgZnVuY3Rpb24gaXNXaXRoaW5UaHJlc2hvbGQoeyB4LCB5IH06IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSkge1xyXG4gICAgY29uc3QgRFJBR19USFJFU0hPTEQgPSAxO1xyXG4gICAgcmV0dXJuIE1hdGguYWJzKHgpID4gRFJBR19USFJFU0hPTEQgfHwgTWF0aC5hYnMoeSkgPiBEUkFHX1RIUkVTSE9MRDtcclxuICB9Il19