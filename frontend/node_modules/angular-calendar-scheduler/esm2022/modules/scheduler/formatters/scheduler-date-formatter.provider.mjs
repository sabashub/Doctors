import { CalendarDateFormatter } from 'angular-calendar';
import { DAYS_IN_WEEK } from '../utils/calendar-scheduler-utils';
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "angular-calendar";
export class SchedulerDateFormatter extends CalendarDateFormatter {
    constructor(dateAdapter) {
        super(dateAdapter);
    }
    /**
     * The time formatting down the left hand side of the day view
     */
    dayViewHour({ date, locale }) {
        return new Intl.DateTimeFormat(locale, { hour: 'numeric', minute: 'numeric' }).format(date);
    }
    weekViewTitle({ dateAdapter, date, locale, weekStartsOn, excludeDays, daysInWeek, startsWithToday }) {
        // http://generatedcontent.org/post/59403168016/esintlapi
        const year = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(date);
        const month = new Intl.DateTimeFormat(locale, { month: 'short' }).format(date);
        const dateInner = startsWithToday || daysInWeek < DAYS_IN_WEEK
            ? date
            : dateAdapter.startOfWeek(date, { weekStartsOn: weekStartsOn });
        // var firstDay: number = date.getDate() - date.getDay() + 1; // First day is the day of the month - the day of the week
        let firstDay = dateInner.getDate();
        while (excludeDays.includes(firstDay)) {
            firstDay += 1;
        }
        let lastDay = firstDay + (daysInWeek - 1); // last day is the first day + (daysInWeek - 1)
        while (excludeDays.includes(lastDay)) {
            lastDay += 1;
        }
        let firstDayMonth = month;
        let lastDayMonth = month;
        let firstDayYear = year;
        let lastDayYear = year;
        if (firstDay < 1) {
            const prevMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() - 1);
            firstDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(prevMonthDate);
            const daysInPrevMonth = this.daysInMonth(prevMonthDate);
            let i = 0;
            let prevMonthDay = daysInPrevMonth;
            for (i = 0; i < Math.abs(firstDay); i++) {
                prevMonthDay--;
            }
            firstDay = prevMonthDay;
            const prevMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(prevMonthDate);
            if (Number(prevMonthYear) < Number(year)) {
                firstDayYear = prevMonthYear;
            }
        }
        const daysInMonth = this.daysInMonth(dateInner);
        if (lastDay > daysInMonth) {
            const nextMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() + 1);
            lastDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(nextMonthDate);
            let i = 0;
            let nextMonthDay = 0;
            for (i = 0; i < (lastDay - daysInMonth); i++) {
                nextMonthDay++;
            }
            lastDay = nextMonthDay;
            const nextMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(nextMonthDate);
            if (Number(nextMonthYear) > Number(year)) {
                lastDayYear = nextMonthYear;
            }
        }
        return `${firstDay}` + (firstDayMonth !== lastDayMonth || lastDay === firstDay ? ' ' + firstDayMonth : '') +
            (firstDayYear !== lastDayYear ? ' ' + firstDayYear : '') +
            (lastDay === firstDay ? '' : ` - ${lastDay} ${lastDayMonth} ${lastDayYear}`);
    }
    daysInMonth(anyDateInMonth) {
        return new Date(anyDateInMonth.getFullYear(), anyDateInMonth.getMonth() + 1, 0).getDate();
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.7", ngImport: i0, type: SchedulerDateFormatter, deps: [{ token: i1.DateAdapter }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.7", ngImport: i0, type: SchedulerDateFormatter });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.7", ngImport: i0, type: SchedulerDateFormatter, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.DateAdapter }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGVyLWRhdGUtZm9ybWF0dGVyLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGliL21vZHVsZXMvc2NoZWR1bGVyL2Zvcm1hdHRlcnMvc2NoZWR1bGVyLWRhdGUtZm9ybWF0dGVyLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBb0MsTUFBTSxrQkFBa0IsQ0FBQztBQUMzRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDakUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBUTNDLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxxQkFBcUI7SUFDN0QsWUFBWSxXQUF3QjtRQUNoQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksV0FBVyxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBZ0M7UUFDN0QsT0FBTyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEcsQ0FBQztJQUVNLGFBQWEsQ0FBQyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBZ0M7UUFDcEkseURBQXlEO1FBQ3pELE1BQU0sSUFBSSxHQUFXLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkYsTUFBTSxLQUFLLEdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFB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RCxPQUFPLEdBQUcsWUFBWSxDQUFDO1lBRXZCLE1BQU0sYUFBYSxHQUFXLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDekcsSUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUN0QyxXQUFXLEdBQUcsYUFBYSxDQUFDO2FBQy9CO1NBQ0o7UUFFRCxPQUFPLEdBQUcsUUFBUSxFQUFFLEdBQUcsQ0FBQyxhQUFhLEtBQUssWUFBWSxJQUFJLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN0RyxDQUFDLFlBQVksS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN4RCxDQUFDLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxPQUFPLElBQUksWUFBWSxJQUFJLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUVPLFdBQVcsQ0FBQyxjQUFvQjtRQUNwQyxPQUFPLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxjQUFjLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzlGLENBQUM7dUdBakZRLHNCQUFzQjsyR0FBdEIsc0JBQXNCOzsyRkFBdEIsc0JBQXNCO2tCQURsQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2FsZW5kYXJEYXRlRm9ybWF0dGVyLCBEYXRlRm9ybWF0dGVyUGFyYW1zLCBEYXRlQWRhcHRlciB9IGZyb20gJ2FuZ3VsYXItY2FsZW5kYXInO1xyXG5pbXBvcnQgeyBEQVlTX0lOX1dFRUsgfSBmcm9tICcuLi91dGlscy9jYWxlbmRhci1zY2hlZHVsZXItdXRpbHMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNjaGVkdWxlckRhdGVGb3JtYXR0ZXJQYXJhbXMgZXh0ZW5kcyBEYXRlRm9ybWF0dGVyUGFyYW1zIHtcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcjtcclxuICAgIHN0YXJ0c1dpdGhUb2RheTogYm9vbGVhbjtcclxufVxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVyRGF0ZUZvcm1hdHRlciBleHRlbmRzIENhbGVuZGFyRGF0ZUZvcm1hdHRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIpIHtcclxuICAgICAgICBzdXBlcihkYXRlQWRhcHRlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgdGltZSBmb3JtYXR0aW5nIGRvd24gdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBkYXkgdmlld1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZGF5Vmlld0hvdXIoeyBkYXRlLCBsb2NhbGUgfTogU2NoZWR1bGVyRGF0ZUZvcm1hdHRlclBhcmFtcyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyBob3VyOiAnbnVtZXJpYycsIG1pbnV0ZTogJ251bWVyaWMnIH0pLmZvcm1hdChkYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgd2Vla1ZpZXdUaXRsZSh7IGRhdGVBZGFwdGVyLCBkYXRlLCBsb2NhbGUsIHdlZWtTdGFydHNPbiwgZXhjbHVkZURheXMsIGRheXNJbldlZWssIHN0YXJ0c1dpdGhUb2RheSB9OiBTY2hlZHVsZXJEYXRlRm9ybWF0dGVyUGFyYW1zKTogc3RyaW5nIHtcclxuICAgICAgICAvLyBodHRwOi8vZ2VuZXJhdGVkY29udGVudC5vcmcvcG9zdC81OTQwMzE2ODAxNi9lc2ludGxhcGlcclxuICAgICAgICBjb25zdCB5ZWFyOiBzdHJpbmcgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgeWVhcjogJ251bWVyaWMnIH0pLmZvcm1hdChkYXRlKTtcclxuICAgICAgICBjb25zdCBtb250aDogc3RyaW5nID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChkYXRlKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0ZUlubmVyOiBEYXRlID0gc3RhcnRzV2l0aFRvZGF5IHx8IGRheXNJbldlZWsgPCBEQVlTX0lOX1dFRUtcclxuICAgICAgICAgICAgPyBkYXRlXHJcbiAgICAgICAgICAgIDogZGF0ZUFkYXB0ZXIuc3RhcnRPZldlZWsoZGF0ZSwgeyB3ZWVrU3RhcnRzT246IHdlZWtTdGFydHNPbiB9KTtcclxuXHJcbiAgICAgICAgLy8gdmFyIGZpcnN0RGF5OiBudW1iZXIgPSBkYXRlLmdldERhdGUoKSAtIGRhdGUuZ2V0RGF5KCkgKyAxOyAvLyBGaXJzdCBkYXkgaXMgdGhlIGRheSBvZiB0aGUgbW9udGggLSB0aGUgZGF5IG9mIHRoZSB3ZWVrXHJcbiAgICAgICAgbGV0IGZpcnN0RGF5OiBudW1iZXIgPSBkYXRlSW5uZXIuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIHdoaWxlIChleGNsdWRlRGF5cy5pbmNsdWRlcyhmaXJzdERheSkpIHtcclxuICAgICAgICAgICAgZmlyc3REYXkgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBsYXN0RGF5OiBudW1iZXIgPSBmaXJzdERheSArIChkYXlzSW5XZWVrIC0gMSk7IC8vIGxhc3QgZGF5IGlzIHRoZSBmaXJzdCBkYXkgKyAoZGF5c0luV2VlayAtIDEpXHJcbiAgICAgICAgd2hpbGUgKGV4Y2x1ZGVEYXlzLmluY2x1ZGVzKGxhc3REYXkpKSB7XHJcbiAgICAgICAgICAgIGxhc3REYXkgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBmaXJzdERheU1vbnRoOiBzdHJpbmcgPSBtb250aDtcclxuICAgICAgICBsZXQgbGFzdERheU1vbnRoOiBzdHJpbmcgPSBtb250aDtcclxuXHJcbiAgICAgICAgbGV0IGZpcnN0RGF5WWVhcjogc3RyaW5nID0geWVhcjtcclxuICAgICAgICBsZXQgbGFzdERheVllYXI6IHN0cmluZyA9IHllYXI7XHJcblxyXG4gICAgICAgIGlmIChmaXJzdERheSA8IDEpIHtcclxuICAgICAgICAgICAgY29uc3QgcHJldk1vbnRoRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKGRhdGVJbm5lci5nZXRGdWxsWWVhcigpLCBkYXRlSW5uZXIuZ2V0TW9udGgoKSAtIDEpO1xyXG4gICAgICAgICAgICBmaXJzdERheU1vbnRoID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChwcmV2TW9udGhEYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgZGF5c0luUHJldk1vbnRoOiBudW1iZXIgPSB0aGlzLmRheXNJbk1vbnRoKHByZXZNb250aERhdGUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGxldCBwcmV2TW9udGhEYXk6IG51bWJlciA9IGRheXNJblByZXZNb250aDtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IE1hdGguYWJzKGZpcnN0RGF5KTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBwcmV2TW9udGhEYXktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmaXJzdERheSA9IHByZXZNb250aERheTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZNb250aFllYXI6IHN0cmluZyA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyB5ZWFyOiAnbnVtZXJpYycgfSkuZm9ybWF0KHByZXZNb250aERhdGUpO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyKHByZXZNb250aFllYXIpIDwgTnVtYmVyKHllYXIpKSB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdERheVllYXIgPSBwcmV2TW9udGhZZWFyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkYXlzSW5Nb250aDogbnVtYmVyID0gdGhpcy5kYXlzSW5Nb250aChkYXRlSW5uZXIpO1xyXG4gICAgICAgIGlmIChsYXN0RGF5ID4gZGF5c0luTW9udGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV4dE1vbnRoRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKGRhdGVJbm5lci5nZXRGdWxsWWVhcigpLCBkYXRlSW5uZXIuZ2V0TW9udGgoKSArIDEpO1xyXG4gICAgICAgICAgICBsYXN0RGF5TW9udGggPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgbW9udGg6ICdzaG9ydCcgfSkuZm9ybWF0KG5leHRNb250aERhdGUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGxldCBuZXh0TW9udGhEYXk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAobGFzdERheSAtIGRheXNJbk1vbnRoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0TW9udGhEYXkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYXN0RGF5ID0gbmV4dE1vbnRoRGF5O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbmV4dE1vbnRoWWVhcjogc3RyaW5nID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IHllYXI6ICdudW1lcmljJyB9KS5mb3JtYXQobmV4dE1vbnRoRGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIobmV4dE1vbnRoWWVhcikgPiBOdW1iZXIoeWVhcikpIHtcclxuICAgICAgICAgICAgICAgIGxhc3REYXlZZWFyID0gbmV4dE1vbnRoWWVhcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGAke2ZpcnN0RGF5fWAgKyAoZmlyc3REYXlNb250aCAhPT0gbGFzdERheU1vbnRoIHx8IGxhc3REYXkgPT09IGZpcnN0RGF5ID8gJyAnICsgZmlyc3REYXlNb250aCA6ICcnKSArXHJcbiAgICAgICAgICAgIChmaXJzdERheVllYXIgIT09IGxhc3REYXlZZWFyID8gJyAnICsgZmlyc3REYXlZZWFyIDogJycpICtcclxuICAgICAgICAgICAgKGxhc3REYXkgPT09IGZpcnN0RGF5ID8gJycgOiBgIC0gJHtsYXN0RGF5fSAke2xhc3REYXlNb250aH0gJHtsYXN0RGF5WWVhcn1gKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRheXNJbk1vbnRoKGFueURhdGVJbk1vbnRoOiBEYXRlKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYW55RGF0ZUluTW9udGguZ2V0RnVsbFllYXIoKSwgYW55RGF0ZUluTW9udGguZ2V0TW9udGgoKSArIDEsIDApLmdldERhdGUoKTtcclxuICAgIH1cclxufVxyXG4iXX0=