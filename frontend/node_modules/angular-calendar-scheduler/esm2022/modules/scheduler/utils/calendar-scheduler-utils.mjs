// import * as momentNS from 'moment';
// const moment = momentNS;
// import moment from 'moment-timezone';
export var DAYS_OF_WEEK;
(function (DAYS_OF_WEEK) {
    DAYS_OF_WEEK[DAYS_OF_WEEK["SUNDAY"] = 0] = "SUNDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["MONDAY"] = 1] = "MONDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["TUESDAY"] = 2] = "TUESDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["WEDNESDAY"] = 3] = "WEDNESDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["THURSDAY"] = 4] = "THURSDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["FRIDAY"] = 5] = "FRIDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["SATURDAY"] = 6] = "SATURDAY";
})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));
const DEFAULT_WEEKEND_DAYS = [
    DAYS_OF_WEEK.SUNDAY,
    DAYS_OF_WEEK.SATURDAY
];
export const DAYS_IN_WEEK = 7;
export const HOURS_IN_DAY = 24;
export const MINUTES_IN_HOUR = 60;
export const SECONDS_IN_DAY = 60 * 60 * 24;
export const DEFAULT_HOUR_SEGMENT_HEIGHT_PX = 40;
export const DEFAULT_EVENT_WIDTH = 1;
export const DEFAULT_HOUR_SEGMENTS = 2;
export function getSchedulerViewHourGrid(dateAdapter, { viewDate, hourSegments, dayStart, dayEnd }) {
    const { setMinutes, setHours, startOfDay, startOfMinute, endOfDay, addMinutes, addHours, addDays } = dateAdapter;
    const hours = [];
    let startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));
    let endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));
    const segmentDuration = MINUTES_IN_HOUR / hourSegments;
    let startOfViewDay = startOfDay(viewDate);
    const endOfViewDay = endOfDay(viewDate);
    let dateAdjustment = (d) => d;
    // this means that we change from or to DST on this day and that's going to cause problems so we bump the date
    if (startOfViewDay.getTimezoneOffset() !== endOfViewDay.getTimezoneOffset()) {
        startOfViewDay = addDays(startOfViewDay, 1);
        startOfView = addDays(startOfView, 1);
        endOfView = addDays(endOfView, 1);
        dateAdjustment = (d) => addDays(d, -1);
    }
    for (let i = 0; i < HOURS_IN_DAY; i++) {
    }
    for (let i = 0; i < HOURS_IN_DAY; i++) {
        const segments = [];
        for (let j = 0; j < hourSegments; j++) {
            const date = addMinutes(addHours(startOfViewDay, i), j * segmentDuration);
            if (date >= startOfView && date < endOfView) {
                segments.push({
                    date: dateAdjustment(date),
                    displayDate: date,
                    isStart: j === 0
                });
            }
        }
        if (segments.length > 0) {
            hours.push({ segments });
        }
    }
    return hours;
}
export function getSchedulerView(dateAdapter, moment, { events = [], viewDate, viewDays, weekStartsOn, startsWithToday, excluded = [], hourSegments = DEFAULT_HOUR_SEGMENTS, dayStart, dayEnd, weekendDays = DEFAULT_WEEKEND_DAYS, hourSegmentHeight = DEFAULT_HOUR_SEGMENT_HEIGHT_PX, eventWidth = DEFAULT_EVENT_WIDTH, logEnabled, }) {
    if (!events) {
        events = [];
    }
    const { addDays, startOfDay, endOfDay, startOfWeek, endOfWeek } = dateAdapter;
    const startOfViewWeek = startsWithToday || viewDays < DAYS_IN_WEEK ? startOfDay(viewDate) : startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const endOfViewWeek = startsWithToday || viewDays < DAYS_IN_WEEK ? addDays(endOfDay(viewDate), viewDays - 1) : endOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const eventsInWeek = getEventsInPeriod(dateAdapter, {
        events: events,
        periodStart: startOfViewWeek,
        periodEnd: endOfViewWeek
    });
    const days = getSchedulerViewDays(dateAdapter, {
        viewDate: viewDate,
        viewDays: viewDays,
        weekStartsOn: weekStartsOn,
        startsWithToday: startsWithToday,
        excluded: excluded,
        weekendDays: weekendDays
    });
    days.forEach((day) => {
        const startOfView = dateAdapter.setMinutes(dateAdapter.setHours(dateAdapter.startOfDay(day.date), dayStart.hour), dayStart.minute);
        const endOfView = dateAdapter.setMinutes(dateAdapter.setHours(dateAdapter.startOfMinute(dateAdapter.endOfDay(day.date)), dayEnd.hour), dayEnd.minute);
        const previousDayEvents = [];
        const eventsInDay = getEventsInPeriod(dateAdapter, {
            events: eventsInWeek,
            periodStart: startOfView,
            periodEnd: endOfView
        });
        const dayEvents = eventsInDay
            .sort((eventA, eventB) => eventA.start.valueOf() - eventB.start.valueOf())
            .map((ev) => {
            const eventStart = ev.start;
            const eventEnd = ev.end || eventStart;
            const startsBeforeDay = eventStart < startOfView;
            const endsAfterDay = dateAdapter.addMinutes(eventEnd, -1) > endOfView;
            const hourHeightModifier = ((hourSegments * hourSegmentHeight) + 1) / MINUTES_IN_HOUR; // +1 for the 1px segment bottom border
            let top = 0;
            if (eventStart > startOfView) {
                top += dateAdapter.differenceInMinutes(eventStart, startOfView);
            }
            top *= hourHeightModifier;
            const startDate = startsBeforeDay ? startOfView : eventStart;
            const endDate = endsAfterDay ? endOfView : eventEnd;
            let height = dateAdapter.differenceInMinutes(endDate, startDate);
            if (!ev.end) {
                height = hourSegmentHeight;
            }
            else {
                height *= hourHeightModifier;
            }
            const bottom = top + height;
            const overlappingPreviousEvents = getOverLappingEvents(ev, previousDayEvents, top, bottom, logEnabled);
            let left = 0;
            while (overlappingPreviousEvents.some(previousEvent => previousEvent.left === left)) {
                left += eventWidth;
            }
            const event = {
                event: ev,
                top: top,
                height: height,
                width: eventWidth,
                left: left,
                startsBeforeDay: startsBeforeDay,
                endsAfterDay: endsAfterDay
            };
            previousDayEvents.push(event);
            return event;
        });
        function getColumnCount(allEvents, prevOverlappingEvents) {
            const columnCount = Math.max(...prevOverlappingEvents.map((ev) => ev.left + 1));
            const nextOverlappingEvents = allEvents
                .filter((ev) => ev.left >= columnCount)
                .filter((ev) => {
                return (getOverLappingEvents(ev, prevOverlappingEvents, ev.top, ev.top + ev.height, logEnabled).length > 0);
            });
            if (nextOverlappingEvents.length > 0) {
                return getColumnCount(allEvents, nextOverlappingEvents);
            }
            else {
                return columnCount;
            }
        }
        const mappedEvents = dayEvents.map(event => {
            const columnCount = getColumnCount(dayEvents, getOverLappingEvents(event, dayEvents, event.top, event.top + event.height, logEnabled));
            const width = 100 / columnCount;
            return { ...event, left: event.left * width, width };
        });
        day.events = mappedEvents.map(event => {
            const overLappingEvents = getOverLappingEvents(event, mappedEvents.filter(otherEvent => otherEvent.left > event.left), event.top, event.top + event.height, logEnabled);
            if (logEnabled) {
                console.log(`DAY [${moment(day.date).format('dddd L')}] ` +
                    `- EVENT ${event.event.id} [${moment(event.event.start).format('dddd L, LTS')} ` +
                    `- ${moment(event.event.end).format('dddd L, LTS')}] overLappingEvents -> `, overLappingEvents);
            }
            if (overLappingEvents.length > 0) {
                return {
                    ...event,
                    width: Math.min(...overLappingEvents.map(otherEvent => otherEvent.left)) - event.left
                };
            }
            return event;
        });
        day.hours = getSchedulerViewHourGrid(dateAdapter, {
            viewDate: viewDate,
            hourSegments: hourSegments,
            dayStart: {
                hour: dayStart.hour,
                minute: dayStart.minute
            },
            dayEnd: {
                hour: dayEnd.hour,
                minute: dayEnd.minute
            }
        }).map((hour) => {
            const date = new Date(day.date.getFullYear(), day.date.getMonth(), day.date.getDate(), hour.segments[0].date.getHours());
            const startOfHour = new Date(day.date.getFullYear(), day.date.getMonth(), day.date.getDate(), hour.segments[0].date.getHours());
            const endOfHour = dateAdapter.addSeconds(dateAdapter.addHours(startOfHour, 1), -1);
            const eventsInHour = getSchedulerEventsInPeriod(dateAdapter, {
                events: day.events,
                periodStart: startOfHour,
                periodEnd: endOfHour
            });
            const segments = hour.segments.map((segment) => {
                segment.date = dateAdapter.setDate(dateAdapter.setMonth(dateAdapter.setYear(segment.date, day.date.getFullYear()), day.date.getMonth()), day.date.getDate());
                const startOfSegment = segment.date;
                const endOfSegment = dateAdapter.addSeconds(dateAdapter.addMinutes(startOfSegment, MINUTES_IN_HOUR / hourSegments), -1);
                const eventsInSegment = getSchedulerEventsInPeriod(dateAdapter, {
                    events: eventsInHour,
                    periodStart: startOfSegment,
                    periodEnd: endOfSegment
                });
                if (logEnabled) {
                    console.log(`SEGMENT [${moment(startOfSegment).format('dddd L, LTS')} - ${moment(endOfSegment).format('dddd L, LTS')}] EVENTS -> `, eventsInSegment);
                }
                return {
                    segment: segment,
                    date: new Date(segment.date),
                    events: eventsInSegment
                };
            });
            return {
                hour: hour,
                date: date,
                events: eventsInHour,
                segments: segments
            };
        });
    });
    return {
        days: days,
        period: {
            events: eventsInWeek,
            start: startOfViewWeek,
            end: endOfViewWeek
        }
    };
}
export function getSchedulerViewDays(dateAdapter, { viewDate, viewDays, weekStartsOn, startsWithToday, excluded = [], weekendDays = DEFAULT_WEEKEND_DAYS }) {
    const start = startsWithToday || viewDays < DAYS_IN_WEEK
        ? new Date(viewDate)
        : dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const days = [];
    const loop = (i) => {
        const date = dateAdapter.addDays(start, i);
        if (!excluded.some((e) => date.getDay() === e)) {
            days.push(getSchedulerDay(dateAdapter, { date, weekendDays }));
        }
    };
    for (let i = 0; i < viewDays; i++) {
        loop(i);
    }
    return days;
}
function getSchedulerDay(dateAdapter, args) {
    const date = args.date;
    const today = dateAdapter.startOfDay(new Date());
    return {
        date: date,
        isPast: date < today,
        isToday: dateAdapter.isSameDay(date, today),
        isFuture: date >= dateAdapter.addDays(today, 1),
        isWeekend: args.weekendDays.indexOf(dateAdapter.getDay(date)) > -1,
        inMonth: dateAdapter.isSameMonth(date, today),
        hours: []
    };
}
function getEventsInPeriod(dateAdapter, { events, periodStart, periodEnd }) {
    return events.filter((event) => isEventInPeriod(dateAdapter, { event: event, periodStart: periodStart, periodEnd: periodEnd }));
}
function getSchedulerEventsInPeriod(dateAdapter, { events, periodStart, periodEnd }) {
    return events.filter((event) => isEventInPeriod(dateAdapter, { event: event.event, periodStart: periodStart, periodEnd: periodEnd }));
}
function isEventInPeriod(dateAdapter, { event, periodStart, periodEnd }) {
    const { isSameSecond, addSeconds } = dateAdapter;
    const eventStart = event.start;
    const eventEnd = event.end || event.start;
    if (eventStart > periodStart && eventStart < periodEnd) {
        return true;
    }
    if (eventEnd > periodStart && eventEnd < periodEnd) {
        return true;
    }
    if (eventStart < periodStart && eventEnd > periodEnd) {
        return true;
    }
    if (isSameSecond(eventStart, periodStart) || isSameSecond(eventStart, periodEnd)) {
        return true;
    }
    if (isSameSecond(addSeconds(eventEnd, -1), periodStart) || isSameSecond(addSeconds(eventEnd, -1), periodEnd)) {
        return true;
    }
    return false;
}
function getOverLappingEvents(event /*SchedulerViewEvent | CalendarSchedulerEvent*/, events, top, bottom, logEnabled = false) {
    return events.filter((previousEvent) => {
        top = Math.round(top);
        bottom = Math.round(bottom);
        const previousEventTop = Math.floor(previousEvent.top);
        const previousEventBottom = Math.floor(previousEvent.top + previousEvent.height);
        if (top < previousEventBottom && previousEventBottom < bottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (event.event?.id || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> top < previousEventBottom && previousEventBottom < bottom');
            }
            return true;
        }
        else if (top < previousEventTop && previousEventTop < bottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (event.event?.id || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> top < previousEventTop && previousEventTop < bottom');
            }
            return true;
        }
        else if (previousEventTop <= top && bottom <= previousEventBottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (event.event?.id || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> previousEventTop <= top && bottom <= previousEventBottom');
            }
            return true;
        }
        return false;
    });
}
function sanitiseHours(hours) {
    return Math.max(Math.min(23, hours), 0);
}
function sanitiseMinutes(minutes) {
    return Math.max(Math.min(59, minutes), 0);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItc2NoZWR1bGVyLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGliL21vZHVsZXMvc2NoZWR1bGVyL3V0aWxzL2NhbGVuZGFyLXNjaGVkdWxlci11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFlQSxzQ0FBc0M7QUFDdEMsMkJBQTJCO0FBQzNCLHdDQUF3QztBQUV4QyxNQUFNLENBQU4sSUFBWSxZQVFYO0FBUkQsV0FBWSxZQUFZO0lBQ3BCLG1EQUFVLENBQUE7SUFDVixtREFBVSxDQUFBO0lBQ1YscURBQVcsQ0FBQTtJQUNYLHlEQUFhLENBQUE7SUFDYix1REFBWSxDQUFBO0lBQ1osbURBQVUsQ0FBQTtJQUNWLHVEQUFZLENBQUE7QUFDaEIsQ0FBQyxFQVJXLFlBQVksS0FBWixZQUFZLFFBUXZCO0FBRUQsTUFBTSxvQkFBb0IsR0FBYTtJQUNuQyxZQUFZLENBQUMsTUFBTTtJQUNuQixZQUFZLENBQUMsUUFBUTtDQUN4QixDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFXLENBQUMsQ0FBQztBQUN0QyxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQVcsRUFBRSxDQUFDO0FBQ3ZDLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBVyxFQUFFLENBQUM7QUFDMUMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFXLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO0FBRW5ELE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHLEVBQUUsQ0FBQztBQUNqRCxNQUFNLENBQUMsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7QUFDckMsTUFBTSxDQUFDLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxDQUFDO0FBY3ZDLE1BQU0sVUFBVSx3QkFBd0IsQ0FDcEMsV0FBd0IsRUFDeEIsRUFDSSxRQUFRLEVBQ1IsWUFBWSxFQUNaLFFBQVEsRUFDUixNQUFNLEVBQ3FCO0lBRS9CLE1BQU0sRUFDRixVQUFVLEVB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O3NCQUNwSyx3QkFBd0IsR0FBRyxnQkFBZ0IsR0FBRywwQkFBMEIsR0FBRyxtQkFBbUIsR0FBRyw4REFBOEQsQ0FBQyxDQUFDO2FBQzFLO1lBQ0QsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUdELFNBQVMsYUFBYSxDQUFDLEtBQWE7SUFDaEMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxPQUFlO0lBQ3BDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM5QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENhbGVuZGFyU2NoZWR1bGVyRXZlbnQsXHJcbiAgICBTY2hlZHVsZXJWaWV3SG91cixcclxuICAgIFNjaGVkdWxlclZpZXdEYXksXHJcbiAgICBTY2hlZHVsZXJWaWV3RXZlbnQsXHJcbiAgICBTY2hlZHVsZXJWaWV3SG91clNlZ21lbnQsXHJcbiAgICBTY2hlZHVsZXJWaWV3LFxyXG4gICAgU2NoZWR1bGVyVmlld1BlcmlvZFxyXG59IGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCB7XHJcbiAgICBXZWVrVmlld0hvdXIsXHJcbiAgICBXZWVrVmlld0hvdXJTZWdtZW50XHJcbn0gZnJvbSAnY2FsZW5kYXItdXRpbHMnO1xyXG5pbXBvcnQgeyBEYXRlQWRhcHRlciB9IGZyb20gJ2FuZ3VsYXItY2FsZW5kYXInO1xyXG5cclxuLy8gaW1wb3J0ICogYXMgbW9tZW50TlMgZnJvbSAnbW9tZW50JztcclxuLy8gY29uc3QgbW9tZW50ID0gbW9tZW50TlM7XHJcbi8vIGltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcclxuXHJcbmV4cG9ydCBlbnVtIERBWVNfT0ZfV0VFSyB7XHJcbiAgICBTVU5EQVkgPSAwLFxyXG4gICAgTU9OREFZID0gMSxcclxuICAgIFRVRVNEQVkgPSAyLFxyXG4gICAgV0VETkVTREFZID0gMyxcclxuICAgIFRIVVJTREFZID0gNCxcclxuICAgIEZSSURBWSA9IDUsXHJcbiAgICBTQVRVUkRBWSA9IDZcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9XRUVLRU5EX0RBWVM6IG51bWJlcltdID0gW1xyXG4gICAgREFZU19PRl9XRUVLLlNVTkRBWSxcclxuICAgIERBWVNfT0ZfV0VFSy5TQVRVUkRBWVxyXG5dO1xyXG5cclxuZXhwb3J0IGNvbnN0IERBWVNfSU5fV0VFSzogbnVtYmVyID0gNztcclxuZXhwb3J0IGNvbnN0IEhPVVJTX0lOX0RBWTogbnVtYmVyID0gMjQ7XHJcbmV4cG9ydCBjb25zdCBNSU5VVEVTX0lOX0hPVVI6IG51bWJlciA9IDYwO1xyXG5leHBvcnQgY29uc3QgU0VDT05EU19JTl9EQVk6IG51bWJlciA9IDYwICogNjAgKiAyNDtcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX0hPVVJfU0VHTUVOVF9IRUlHSFRfUFggPSA0MDtcclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfRVZFTlRfV0lEVEggPSAxO1xyXG5leHBvcnQgY29uc3QgREVGQVVMVF9IT1VSX1NFR01FTlRTID0gMjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVGltZSB7XHJcbiAgICBob3VyOiBudW1iZXI7XHJcbiAgICBtaW51dGU6IG51bWJlcjtcclxuICB9XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEdldFNjaGVkdWxlclZpZXdIb3VyR3JpZEFyZ3Mge1xyXG4gICAgdmlld0RhdGU6IERhdGU7XHJcbiAgICBob3VyU2VnbWVudHM6IG51bWJlcjtcclxuICAgIGRheVN0YXJ0OiBUaW1lO1xyXG4gICAgZGF5RW5kOiBUaW1lO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2NoZWR1bGVyVmlld0hvdXJHcmlkKFxyXG4gICAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gICAge1xyXG4gICAgICAgIHZpZXdEYXRlLFxyXG4gICAgICAgIGhvdXJTZWdtZW50cyxcclxuICAgICAgICBkYXlTdGFydCxcclxuICAgICAgICBkYXlFbmRcclxuICAgIH06IEdldFNjaGVkdWxlclZpZXdIb3VyR3JpZEFyZ3NcclxuKTogV2Vla1ZpZXdIb3VyW10ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICAgIHNldE1pbnV0ZXMsXHJcbiAgICAgICAgc2V0SG91cnMsXHJcbiAgICAgICAgc3RhcnRPZkRheSxcclxuICAgICAgICBzdGFydE9mTWludXRlLFxyXG4gICAgICAgIGVuZE9mRGF5LFxyXG4gICAgICAgIGFkZE1pbnV0ZXMsXHJcbiAgICAgICAgYWRkSG91cnMsXHJcbiAgICAgICAgYWRkRGF5c1xyXG4gICAgICB9ID0gZGF0ZUFkYXB0ZXI7XHJcbiAgICBjb25zdCBob3VyczogV2Vla1ZpZXdIb3VyW10gPSBbXTtcclxuXHJcbiAgICBsZXQgc3RhcnRPZlZpZXc6IERhdGUgPSBzZXRNaW51dGVzKFxyXG4gICAgICAgIHNldEhvdXJzKHN0YXJ0T2ZEYXkodmlld0RhdGUpLCBzYW5pdGlzZUhvdXJzKGRheVN0YXJ0LmhvdXIpKSxcclxuICAgICAgICBzYW5pdGlzZU1pbnV0ZXMoZGF5U3RhcnQubWludXRlKVxyXG4gICAgKTtcclxuICAgIGxldCBlbmRPZlZpZXc6IERhdGUgPSBzZXRNaW51dGVzKFxyXG4gICAgICAgIHNldEhvdXJzKHN0YXJ0T2ZNaW51dGUoZW5kT2ZEYXkodmlld0RhdGUpKSwgc2FuaXRpc2VIb3VycyhkYXlFbmQuaG91cikpLFxyXG4gICAgICAgIHNhbml0aXNlTWludXRlcyhkYXlFbmQubWludXRlKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IHNlZ21lbnREdXJhdGlvbjogbnVtYmVyID0gTUlOVVRFU19JTl9IT1VSIC8gaG91clNlZ21lbnRzO1xyXG4gICAgbGV0IHN0YXJ0T2ZWaWV3RGF5OiBEYXRlID0gc3RhcnRPZkRheSh2aWV3RGF0ZSk7XHJcbiAgICBjb25zdCBlbmRPZlZpZXdEYXk6IERhdGUgPSBlbmRPZkRheSh2aWV3RGF0ZSk7XHJcbiAgICBsZXQgZGF0ZUFkanVzdG1lbnQ6IChkOiBEYXRlKSA9PiBEYXRlID0gKGQ6IERhdGUpID0+IGQ7XHJcblxyXG4gICAgLy8gdGhpcyBtZWFucyB0aGF0IHdlIGNoYW5nZSBmcm9tIG9yIHRvIERTVCBvbiB0aGlzIGRheSBhbmQgdGhhdCdzIGdvaW5nIHRvIGNhdXNlIHByb2JsZW1zIHNvIHdlIGJ1bXAgdGhlIGRhdGVcclxuICAgIGlmIChzdGFydE9mVmlld0RheS5nZXRUaW1lem9uZU9mZnNldCgpICE9PSBlbmRPZlZpZXdEYXkuZ2V0VGltZXpvbmVPZmZzZXQoKSkge1xyXG4gICAgICAgIHN0YXJ0T2ZWaWV3RGF5ID0gYWRkRGF5cyhzdGFydE9mVmlld0RheSwgMSk7XHJcbiAgICAgICAgc3RhcnRPZlZpZXcgPSBhZGREYXlzKHN0YXJ0T2ZWaWV3LCAxKTtcclxuICAgICAgICBlbmRPZlZpZXcgPSBhZGREYXlzKGVuZE9mVmlldywgMSk7XHJcbiAgICAgICAgZGF0ZUFkanVzdG1lbnQgPSAoZDogRGF0ZSkgPT4gYWRkRGF5cyhkLCAtMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IEhPVVJTX0lOX0RBWTsgaSsrKSB7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IEhPVVJTX0lOX0RBWTsgaSsrKSB7XHJcbiAgICAgICAgY29uc3Qgc2VnbWVudHM6IFdlZWtWaWV3SG91clNlZ21lbnRbXSA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGo6IG51bWJlciA9IDA7IGogPCBob3VyU2VnbWVudHM7IGorKykge1xyXG4gICAgICAgICAgY29uc3QgZGF0ZTogRGF0ZSA9IGFkZE1pbnV0ZXMoXHJcbiAgICAgICAgICAgIGFkZEhvdXJzKHN0YXJ0T2ZWaWV3RGF5LCBpKSxcclxuICAgICAgICAgICAgaiAqIHNlZ21lbnREdXJhdGlvblxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGlmIChkYXRlID49IHN0YXJ0T2ZWaWV3ICYmIGRhdGUgPCBlbmRPZlZpZXcpIHtcclxuICAgICAgICAgICAgc2VnbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgZGF0ZTogZGF0ZUFkanVzdG1lbnQoZGF0ZSksXHJcbiAgICAgICAgICAgICAgZGlzcGxheURhdGU6IGRhdGUsXHJcbiAgICAgICAgICAgICAgaXNTdGFydDogaiA9PT0gMFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGhvdXJzLnB1c2goeyBzZWdtZW50cyB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGhvdXJzO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEdldFNjaGVkdWxlclZpZXdBcmdzIHtcclxuICAgIGV2ZW50cz86IENhbGVuZGFyU2NoZWR1bGVyRXZlbnRbXTtcclxuICAgIHZpZXdEYXRlOiBEYXRlO1xyXG4gICAgdmlld0RheXM6IG51bWJlcjtcclxuICAgIGhvdXJTZWdtZW50czogMSB8IDIgfCA0IHwgNjtcclxuICAgIHdlZWtTdGFydHNPbjogbnVtYmVyO1xyXG4gICAgc3RhcnRzV2l0aFRvZGF5OiBib29sZWFuO1xyXG4gICAgZGF5U3RhcnQ6IFRpbWU7XHJcbiAgICBkYXlFbmQ6IFRpbWU7XHJcbiAgICB3ZWVrZW5kRGF5cz86IG51bWJlcltdO1xyXG4gICAgZXhjbHVkZWQ/OiBudW1iZXJbXTtcclxuICAgIGV2ZW50V2lkdGg6IG51bWJlcjtcclxuICAgIGhvdXJTZWdtZW50SGVpZ2h0OiBudW1iZXI7XHJcbiAgICBsb2dFbmFibGVkPzogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNjaGVkdWxlclZpZXcoXHJcbiAgICBkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsXHJcbiAgICBtb21lbnQ6IGFueSxcclxuICAgIHtcclxuICAgICAgICBldmVudHMgPSBbXSxcclxuICAgICAgICB2aWV3RGF0ZSxcclxuICAgICAgICB2aWV3RGF5cyxcclxuICAgICAgICB3ZWVrU3RhcnRzT24sXHJcbiAgICAgICAgc3RhcnRzV2l0aFRvZGF5LFxyXG4gICAgICAgIGV4Y2x1ZGVkID0gW10sXHJcbiAgICAgICAgaG91clNlZ21lbnRzID0gREVGQVVMVF9IT1VSX1NFR01FTlRTLFxyXG4gICAgICAgIGRheVN0YXJ0LFxyXG4gICAgICAgIGRheUVuZCxcclxuICAgICAgICB3ZWVrZW5kRGF5cyA9IERFRkFVTFRfV0VFS0VORF9EQVlTLFxyXG4gICAgICAgIGhvdXJTZWdtZW50SGVpZ2h0ID0gREVGQVVMVF9IT1VSX1NFR01FTlRfSEVJR0hUX1BYLFxyXG4gICAgICAgIGV2ZW50V2lkdGggPSBERUZBVUxUX0VWRU5UX1dJRFRILFxyXG4gICAgICAgIGxvZ0VuYWJsZWQsXHJcbiAgICB9OiBHZXRTY2hlZHVsZXJWaWV3QXJnc1xyXG4pOiBTY2hlZHVsZXJWaWV3IHtcclxuICAgIGlmICghZXZlbnRzKSB7IGV2ZW50cyA9IFtdOyB9XHJcblxyXG4gICAgY29uc3QgeyBhZGREYXlzLCBzdGFydE9mRGF5LCBlbmRPZkRheSwgc3RhcnRPZldlZWssIGVuZE9mV2VlayB9ID0gZGF0ZUFkYXB0ZXI7XHJcbiAgICBjb25zdCBzdGFydE9mVmlld1dlZWs6IERhdGUgPSBzdGFydHNXaXRoVG9kYXkgfHwgdmlld0RheXMgPCBEQVlTX0lOX1dFRUsgPyBzdGFydE9mRGF5KHZpZXdEYXRlKSA6IHN0YXJ0T2ZXZWVrKHZpZXdEYXRlLCB7IHdlZWtTdGFydHNPbjogd2Vla1N0YXJ0c09uIH0pO1xyXG4gICAgY29uc3QgZW5kT2ZWaWV3V2VlazogRGF0ZSA9IHN0YXJ0c1dpdGhUb2RheSB8fCB2aWV3RGF5cyA8IERBWVNfSU5fV0VFSyA/IGFkZERheXMoZW5kT2ZEYXkodmlld0RhdGUpLCB2aWV3RGF5cyAtIDEpIDogZW5kT2ZXZWVrKHZpZXdEYXRlLCB7IHdlZWtTdGFydHNPbjogd2Vla1N0YXJ0c09uIH0pO1xyXG5cclxuICAgIGNvbnN0IGV2ZW50c0luV2VlazogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFtdID0gZ2V0RXZlbnRzSW5QZXJpb2QoZGF0ZUFkYXB0ZXIsIHtcclxuICAgICAgICBldmVudHM6IGV2ZW50cyxcclxuICAgICAgICBwZXJpb2RTdGFydDogc3RhcnRPZlZpZXdXZWVrLFxyXG4gICAgICAgIHBlcmlvZEVuZDogZW5kT2ZWaWV3V2Vla1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZGF5czogU2NoZWR1bGVyVmlld0RheVtdID0gZ2V0U2NoZWR1bGVyVmlld0RheXMoZGF0ZUFkYXB0ZXIsIHtcclxuICAgICAgICB2aWV3RGF0ZTogdmlld0RhdGUsXHJcbiAgICAgICAgdmlld0RheXM6IHZpZXdEYXlzLFxyXG4gICAgICAgIHdlZWtTdGFydHNPbjogd2Vla1N0YXJ0c09uLFxyXG4gICAgICAgIHN0YXJ0c1dpdGhUb2RheTogc3RhcnRzV2l0aFRvZGF5LFxyXG4gICAgICAgIGV4Y2x1ZGVkOiBleGNsdWRlZCxcclxuICAgICAgICB3ZWVrZW5kRGF5czogd2Vla2VuZERheXNcclxuICAgIH0pO1xyXG4gICAgZGF5cy5mb3JFYWNoKChkYXk6IFNjaGVkdWxlclZpZXdEYXkpID0+IHtcclxuICAgICAgICBjb25zdCBzdGFydE9mVmlldzogRGF0ZSA9IGRhdGVBZGFwdGVyLnNldE1pbnV0ZXMoZGF0ZUFkYXB0ZXIuc2V0SG91cnMoZGF0ZUFkYXB0ZXIuc3RhcnRPZkRheShkYXkuZGF0ZSksIGRheVN0YXJ0LmhvdXIpLCBkYXlTdGFydC5taW51dGUpO1xyXG4gICAgICAgIGNvbnN0IGVuZE9mVmlldzogRGF0ZSA9IGRhdGVBZGFwdGVyLnNldE1pbnV0ZXMoZGF0ZUFkYXB0ZXIuc2V0SG91cnMoZGF0ZUFkYXB0ZXIuc3RhcnRPZk1pbnV0ZShkYXRlQWRhcHRlci5lbmRPZkRheShkYXkuZGF0ZSkpLCBkYXlFbmQuaG91ciksIGRheUVuZC5taW51dGUpO1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzRGF5RXZlbnRzOiBTY2hlZHVsZXJWaWV3RXZlbnRbXSA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdCBldmVudHNJbkRheTogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFtdID0gZ2V0RXZlbnRzSW5QZXJpb2QoZGF0ZUFkYXB0ZXIsIHtcclxuICAgICAgICAgICAgZXZlbnRzOiBldmVudHNJbldlZWssXHJcbiAgICAgICAgICAgIHBlcmlvZFN0YXJ0OiBzdGFydE9mVmlldyxcclxuICAgICAgICAgICAgcGVyaW9kRW5kOiBlbmRPZlZpZXdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF5RXZlbnRzID0gZXZlbnRzSW5EYXlcclxuICAgICAgICAgICAgLnNvcnQoKGV2ZW50QTogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCwgZXZlbnRCOiBDYWxlbmRhclNjaGVkdWxlckV2ZW50KSA9PiBldmVudEEuc3RhcnQudmFsdWVPZigpIC0gZXZlbnRCLnN0YXJ0LnZhbHVlT2YoKSlcclxuICAgICAgICAgICAgLm1hcCgoZXY6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhcnQ6IERhdGUgPSBldi5zdGFydDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50RW5kOiBEYXRlID0gZXYuZW5kIHx8IGV2ZW50U3RhcnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydHNCZWZvcmVEYXk6IGJvb2xlYW4gPSBldmVudFN0YXJ0IDwgc3RhcnRPZlZpZXc7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbmRzQWZ0ZXJEYXk6IGJvb2xlYW4gPSBkYXRlQWRhcHRlci5hZGRNaW51dGVzKGV2ZW50RW5kLCAtMSkgPiBlbmRPZlZpZXc7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBob3VySGVpZ2h0TW9kaWZpZXI6IG51bWJlciA9ICgoaG91clNlZ21lbnRzICogaG91clNlZ21lbnRIZWlnaHQpICsgMSkgLyBNSU5VVEVTX0lOX0hPVVI7IC8vICsxIGZvciB0aGUgMXB4IHNlZ21lbnQgYm90dG9tIGJvcmRlclxyXG5cclxuICAgICAgICAgICAgICAgIGxldCB0b3A6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnRTdGFydCA+IHN0YXJ0T2ZWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wICs9IGRhdGVBZGFwdGVyLmRpZmZlcmVuY2VJbk1pbnV0ZXMoZXZlbnRTdGFydCwgc3RhcnRPZlZpZXcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdG9wICo9IGhvdXJIZWlnaHRNb2RpZmllcjtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydERhdGU6IERhdGUgPSBzdGFydHNCZWZvcmVEYXkgPyBzdGFydE9mVmlldyA6IGV2ZW50U3RhcnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbmREYXRlOiBEYXRlID0gZW5kc0FmdGVyRGF5ID8gZW5kT2ZWaWV3IDogZXZlbnRFbmQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgaGVpZ2h0OiBudW1iZXIgPSBkYXRlQWRhcHRlci5kaWZmZXJlbmNlSW5NaW51dGVzKGVuZERhdGUsIHN0YXJ0RGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWV2LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGhvdXJTZWdtZW50SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQgKj0gaG91ckhlaWdodE1vZGlmaWVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGJvdHRvbTogbnVtYmVyID0gdG9wICsgaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3ZlcmxhcHBpbmdQcmV2aW91c0V2ZW50cyA9IGdldE92ZXJMYXBwaW5nRXZlbnRzKFxyXG4gICAgICAgICAgICAgICAgICAgIGV2LFxyXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzRGF5RXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvcCxcclxuICAgICAgICAgICAgICAgICAgICBib3R0b20sXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nRW5hYmxlZFxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdDogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChvdmVybGFwcGluZ1ByZXZpb3VzRXZlbnRzLnNvbWUocHJldmlvdXNFdmVudCA9PiBwcmV2aW91c0V2ZW50LmxlZnQgPT09IGxlZnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdCArPSBldmVudFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50OiBTY2hlZHVsZXJWaWV3RXZlbnQgPVxyXG4gICAgICAgICAgICAgICAgICAgIDxTY2hlZHVsZXJWaWV3RXZlbnQ+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGV2ZW50V2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0c0JlZm9yZURheTogc3RhcnRzQmVmb3JlRGF5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRzQWZ0ZXJEYXk6IGVuZHNBZnRlckRheVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcHJldmlvdXNEYXlFdmVudHMucHVzaChldmVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29sdW1uQ291bnQoXHJcbiAgICAgICAgICAgIGFsbEV2ZW50czogU2NoZWR1bGVyVmlld0V2ZW50W10sXHJcbiAgICAgICAgICAgIHByZXZPdmVybGFwcGluZ0V2ZW50czogU2NoZWR1bGVyVmlld0V2ZW50W11cclxuICAgICAgICApOiBudW1iZXIge1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5Db3VudCA9IE1hdGgubWF4KFxyXG4gICAgICAgICAgICAgICAgLi4ucHJldk92ZXJsYXBwaW5nRXZlbnRzLm1hcCgoZXY6IFNjaGVkdWxlclZpZXdFdmVudCkgPT4gZXYubGVmdCArIDEpXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBuZXh0T3ZlcmxhcHBpbmdFdmVudHMgPSBhbGxFdmVudHNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKGV2OiBTY2hlZHVsZXJWaWV3RXZlbnQpID0+IGV2LmxlZnQgPj0gY29sdW1uQ291bnQpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChldjogU2NoZWR1bGVyVmlld0V2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0T3ZlckxhcHBpbmdFdmVudHMoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZPdmVybGFwcGluZ0V2ZW50cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2LnRvcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2LnRvcCArIGV2LmhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0VuYWJsZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgKS5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAobmV4dE92ZXJsYXBwaW5nRXZlbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb2x1bW5Db3VudChhbGxFdmVudHMsIG5leHRPdmVybGFwcGluZ0V2ZW50cyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uQ291bnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1hcHBlZEV2ZW50cyA9IGRheUV2ZW50cy5tYXAoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5Db3VudCA9IGdldENvbHVtbkNvdW50KFxyXG4gICAgICAgICAgICAgICAgZGF5RXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgZ2V0T3ZlckxhcHBpbmdFdmVudHMoXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF5RXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnRvcCxcclxuICAgICAgICAgICAgICAgICAgICBldmVudC50b3AgKyBldmVudC5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nRW5hYmxlZFxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgd2lkdGggPSAxMDAgLyBjb2x1bW5Db3VudDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgLi4uZXZlbnQsIGxlZnQ6IGV2ZW50LmxlZnQgKiB3aWR0aCwgd2lkdGggfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZGF5LmV2ZW50cyA9IG1hcHBlZEV2ZW50cy5tYXAoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvdmVyTGFwcGluZ0V2ZW50cyA9IGdldE92ZXJMYXBwaW5nRXZlbnRzKGV2ZW50LFxyXG4gICAgICAgICAgICAgIG1hcHBlZEV2ZW50cy5maWx0ZXIob3RoZXJFdmVudCA9PiBvdGhlckV2ZW50LmxlZnQgPiBldmVudC5sZWZ0KSxcclxuICAgICAgICAgICAgICBldmVudC50b3AsXHJcbiAgICAgICAgICAgICAgZXZlbnQudG9wICsgZXZlbnQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgIGxvZ0VuYWJsZWRcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChsb2dFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgICAgICAgICAgICBgREFZIFske21vbWVudChkYXkuZGF0ZSkuZm9ybWF0KCdkZGRkIEwnKX1dIGAgK1xyXG4gICAgICAgICAgICAgICAgICAgIGAtIEVWRU5UICR7ZXZlbnQuZXZlbnQuaWR9IFske21vbWVudChldmVudC5ldmVudC5zdGFydCkuZm9ybWF0KCdkZGRkIEwsIExUUycpfSBgICtcclxuICAgICAgICAgICAgICAgICAgICBgLSAke21vbWVudChldmVudC5ldmVudC5lbmQpLmZvcm1hdCgnZGRkZCBMLCBMVFMnKX1dIG92ZXJMYXBwaW5nRXZlbnRzIC0+IGAsXHJcbiAgICAgICAgICAgICAgICAgICAgb3ZlckxhcHBpbmdFdmVudHNcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvdmVyTGFwcGluZ0V2ZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLmV2ZW50LFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6XHJcbiAgICAgICAgICAgICAgICAgIE1hdGgubWluKFxyXG4gICAgICAgICAgICAgICAgICAgIC4uLm92ZXJMYXBwaW5nRXZlbnRzLm1hcChvdGhlckV2ZW50ID0+IG90aGVyRXZlbnQubGVmdClcclxuICAgICAgICAgICAgICAgICAgKSAtIGV2ZW50LmxlZnRcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBldmVudDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZGF5LmhvdXJzID0gZ2V0U2NoZWR1bGVyVmlld0hvdXJHcmlkKGRhdGVBZGFwdGVyLCB7XHJcbiAgICAgICAgICAgIHZpZXdEYXRlOiB2aWV3RGF0ZSxcclxuICAgICAgICAgICAgaG91clNlZ21lbnRzOiBob3VyU2VnbWVudHMsXHJcbiAgICAgICAgICAgIGRheVN0YXJ0OiB7XHJcbiAgICAgICAgICAgICAgICBob3VyOiBkYXlTdGFydC5ob3VyLFxyXG4gICAgICAgICAgICAgICAgbWludXRlOiBkYXlTdGFydC5taW51dGVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZGF5RW5kOiB7XHJcbiAgICAgICAgICAgICAgICBob3VyOiBkYXlFbmQuaG91cixcclxuICAgICAgICAgICAgICAgIG1pbnV0ZTogZGF5RW5kLm1pbnV0ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkubWFwKChob3VyOiBXZWVrVmlld0hvdXIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZTogRGF0ZSA9IG5ldyBEYXRlKGRheS5kYXRlLmdldEZ1bGxZZWFyKCksIGRheS5kYXRlLmdldE1vbnRoKCksIGRheS5kYXRlLmdldERhdGUoKSwgaG91ci5zZWdtZW50c1swXS5kYXRlLmdldEhvdXJzKCkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRPZkhvdXI6IERhdGUgPSBuZXcgRGF0ZShkYXkuZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXkuZGF0ZS5nZXRNb250aCgpLCBkYXkuZGF0ZS5nZXREYXRlKCksIGhvdXIuc2VnbWVudHNbMF0uZGF0ZS5nZXRIb3VycygpKTtcclxuICAgICAgICAgICAgY29uc3QgZW5kT2ZIb3VyOiBEYXRlID0gZGF0ZUFkYXB0ZXIuYWRkU2Vjb25kcyhkYXRlQWRhcHRlci5hZGRIb3VycyhzdGFydE9mSG91ciwgMSksIC0xKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50c0luSG91cjogU2NoZWR1bGVyVmlld0V2ZW50W10gPSBnZXRTY2hlZHVsZXJFdmVudHNJblBlcmlvZChkYXRlQWRhcHRlciwge1xyXG4gICAgICAgICAgICAgICAgZXZlbnRzOiBkYXkuZXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgcGVyaW9kU3RhcnQ6IHN0YXJ0T2ZIb3VyLFxyXG4gICAgICAgICAgICAgICAgcGVyaW9kRW5kOiBlbmRPZkhvdXJcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzZWdtZW50czogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50W10gPVxyXG4gICAgICAgICAgICAgICAgaG91ci5zZWdtZW50cy5tYXAoKHNlZ21lbnQ6IFdlZWtWaWV3SG91clNlZ21lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50LmRhdGUgPSBkYXRlQWRhcHRlci5zZXREYXRlKGRhdGVBZGFwdGVyLnNldE1vbnRoKGRhdGVBZGFwdGVyLnNldFllYXIoc2VnbWVudC5kYXRlLCBkYXkuZGF0ZS5nZXRGdWxsWWVhcigpKSwgZGF5LmRhdGUuZ2V0TW9udGgoKSksIGRheS5kYXRlLmdldERhdGUoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0T2ZTZWdtZW50OiBEYXRlID0gc2VnbWVudC5kYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZE9mU2VnbWVudDogRGF0ZSA9IGRhdGVBZGFwdGVyLmFkZFNlY29uZHMoZGF0ZUFkYXB0ZXIuYWRkTWludXRlcyhzdGFydE9mU2VnbWVudCwgTUlOVVRFU19JTl9IT1VSIC8gaG91clNlZ21lbnRzKSwgLTEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudHNJblNlZ21lbnQ6IFNjaGVkdWxlclZpZXdFdmVudFtdID0gZ2V0U2NoZWR1bGVyRXZlbnRzSW5QZXJpb2QoZGF0ZUFkYXB0ZXIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzOiBldmVudHNJbkhvdXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmlvZFN0YXJ0OiBzdGFydE9mU2VnbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyaW9kRW5kOiBlbmRPZlNlZ21lbnRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgU0VHTUVOVCBbJHttb21lbnQoc3RhcnRPZlNlZ21lbnQpLmZvcm1hdCgnZGRkZCBMLCBMVFMnKX0gLSAke21vbWVudChlbmRPZlNlZ21lbnQpLmZvcm1hdCgnZGRkZCBMLCBMVFMnKX1dIEVWRU5UUyAtPiBgLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzSW5TZWdtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPFNjaGVkdWxlclZpZXdIb3VyU2VnbWVudD57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKHNlZ21lbnQuZGF0ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50czogZXZlbnRzSW5TZWdtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIDxTY2hlZHVsZXJWaWV3SG91cj57XHJcbiAgICAgICAgICAgICAgICBob3VyOiBob3VyLFxyXG4gICAgICAgICAgICAgICAgZGF0ZTogZGF0ZSxcclxuICAgICAgICAgICAgICAgIGV2ZW50czogZXZlbnRzSW5Ib3VyLFxyXG4gICAgICAgICAgICAgICAgc2VnbWVudHM6IHNlZ21lbnRzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gPFNjaGVkdWxlclZpZXc+e1xyXG4gICAgICAgIGRheXM6IGRheXMsXHJcbiAgICAgICAgcGVyaW9kOiA8U2NoZWR1bGVyVmlld1BlcmlvZD57XHJcbiAgICAgICAgICAgIGV2ZW50czogZXZlbnRzSW5XZWVrLFxyXG4gICAgICAgICAgICBzdGFydDogc3RhcnRPZlZpZXdXZWVrLFxyXG4gICAgICAgICAgICBlbmQ6IGVuZE9mVmlld1dlZWtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEdldFNjaGVkdWxlclZpZXdEYXlzQXJncyB7XHJcbiAgICB2aWV3RGF0ZTogRGF0ZTtcclxuICAgIHZpZXdEYXlzOiBudW1iZXI7XHJcbiAgICB3ZWVrU3RhcnRzT246IG51bWJlcjtcclxuICAgIHN0YXJ0c1dpdGhUb2RheTogYm9vbGVhbjtcclxuICAgIGV4Y2x1ZGVkPzogbnVtYmVyW107XHJcbiAgICB3ZWVrZW5kRGF5cz86IG51bWJlcltdO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2NoZWR1bGVyVmlld0RheXMoXHJcbiAgICBkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsXHJcbiAgICB7XHJcbiAgICAgICAgdmlld0RhdGUsXHJcbiAgICAgICAgdmlld0RheXMsXHJcbiAgICAgICAgd2Vla1N0YXJ0c09uLFxyXG4gICAgICAgIHN0YXJ0c1dpdGhUb2RheSxcclxuICAgICAgICBleGNsdWRlZCA9IFtdLFxyXG4gICAgICAgIHdlZWtlbmREYXlzID0gREVGQVVMVF9XRUVLRU5EX0RBWVNcclxuICAgIH06IEdldFNjaGVkdWxlclZpZXdEYXlzQXJnc1xyXG4pOiBTY2hlZHVsZXJWaWV3RGF5W10ge1xyXG4gICAgY29uc3Qgc3RhcnQgPSBzdGFydHNXaXRoVG9kYXkgfHwgdmlld0RheXMgPCBEQVlTX0lOX1dFRUtcclxuICAgICAgICA/IG5ldyBEYXRlKHZpZXdEYXRlKVxyXG4gICAgICAgIDogZGF0ZUFkYXB0ZXIuc3RhcnRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uOiB3ZWVrU3RhcnRzT24gfSk7XHJcbiAgICBjb25zdCBkYXlzOiBTY2hlZHVsZXJWaWV3RGF5W10gPSBbXTtcclxuICAgIGNvbnN0IGxvb3AgPSAoaTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGF0ZSA9IGRhdGVBZGFwdGVyLmFkZERheXMoc3RhcnQsIGkpO1xyXG4gICAgICAgIGlmICghZXhjbHVkZWQuc29tZSgoZTogbnVtYmVyKSA9PiBkYXRlLmdldERheSgpID09PSBlKSkge1xyXG4gICAgICAgICAgICBkYXlzLnB1c2goZ2V0U2NoZWR1bGVyRGF5KGRhdGVBZGFwdGVyLCB7IGRhdGUsIHdlZWtlbmREYXlzIH0pKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aWV3RGF5czsgaSsrKSB7XHJcbiAgICAgICAgbG9vcChpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYXlzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTY2hlZHVsZXJEYXkoZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLCBhcmdzOiB7IGRhdGU6IERhdGUsIHdlZWtlbmREYXlzOiBudW1iZXJbXSB9KTogU2NoZWR1bGVyVmlld0RheSB7XHJcbiAgICBjb25zdCBkYXRlOiBEYXRlID0gYXJncy5kYXRlO1xyXG4gICAgY29uc3QgdG9kYXk6IERhdGUgPSBkYXRlQWRhcHRlci5zdGFydE9mRGF5KG5ldyBEYXRlKCkpO1xyXG5cclxuICAgIHJldHVybiA8U2NoZWR1bGVyVmlld0RheT57XHJcbiAgICAgICAgZGF0ZTogZGF0ZSxcclxuICAgICAgICBpc1Bhc3Q6IGRhdGUgPCB0b2RheSxcclxuICAgICAgICBpc1RvZGF5OiBkYXRlQWRhcHRlci5pc1NhbWVEYXkoZGF0ZSwgdG9kYXkpLFxyXG4gICAgICAgIGlzRnV0dXJlOiBkYXRlID49IGRhdGVBZGFwdGVyLmFkZERheXModG9kYXksIDEpLFxyXG4gICAgICAgIGlzV2Vla2VuZDogYXJncy53ZWVrZW5kRGF5cy5pbmRleE9mKGRhdGVBZGFwdGVyLmdldERheShkYXRlKSkgPiAtMSxcclxuICAgICAgICBpbk1vbnRoOiBkYXRlQWRhcHRlci5pc1NhbWVNb250aChkYXRlLCB0b2RheSksXHJcbiAgICAgICAgaG91cnM6IFtdXHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEdldEV2ZW50c0luUGVyaW9kQXJncyB7XHJcbiAgICBldmVudHM6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnRbXTtcclxuICAgIHBlcmlvZFN0YXJ0OiBEYXRlO1xyXG4gICAgcGVyaW9kRW5kOiBEYXRlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRFdmVudHNJblBlcmlvZChcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICAgIHtcclxuICAgICAgICBldmVudHMsXHJcbiAgICAgICAgcGVyaW9kU3RhcnQsXHJcbiAgICAgICAgcGVyaW9kRW5kXHJcbiAgICB9OiBHZXRFdmVudHNJblBlcmlvZEFyZ3NcclxuKTogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFtdIHtcclxuICAgIHJldHVybiBldmVudHMuZmlsdGVyKChldmVudCkgPT4gaXNFdmVudEluUGVyaW9kKGRhdGVBZGFwdGVyLCB7IGV2ZW50OiBldmVudCwgcGVyaW9kU3RhcnQ6IHBlcmlvZFN0YXJ0LCBwZXJpb2RFbmQ6IHBlcmlvZEVuZCB9KSk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgR2V0U2NoZWR1bGVyRXZlbnRzSW5QZXJpb2RBcmdzIHtcclxuICAgIGV2ZW50czogU2NoZWR1bGVyVmlld0V2ZW50W107XHJcbiAgICBwZXJpb2RTdGFydDogRGF0ZTtcclxuICAgIHBlcmlvZEVuZDogRGF0ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U2NoZWR1bGVyRXZlbnRzSW5QZXJpb2QoXHJcbiAgICBkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsXHJcbiAgICB7XHJcbiAgICAgICAgZXZlbnRzLFxyXG4gICAgICAgIHBlcmlvZFN0YXJ0LFxyXG4gICAgICAgIHBlcmlvZEVuZFxyXG4gICAgfTogR2V0U2NoZWR1bGVyRXZlbnRzSW5QZXJpb2RBcmdzXHJcbik6IFNjaGVkdWxlclZpZXdFdmVudFtdIHtcclxuICAgIHJldHVybiBldmVudHMuZmlsdGVyKChldmVudCkgPT4gaXNFdmVudEluUGVyaW9kKGRhdGVBZGFwdGVyLCB7IGV2ZW50OiBldmVudC5ldmVudCwgcGVyaW9kU3RhcnQ6IHBlcmlvZFN0YXJ0LCBwZXJpb2RFbmQ6IHBlcmlvZEVuZCB9KSk7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJc0V2ZW50SW5QZXJpb2RBcmdzIHtcclxuICAgIGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50O1xyXG4gICAgcGVyaW9kU3RhcnQ6IERhdGU7XHJcbiAgICBwZXJpb2RFbmQ6IERhdGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzRXZlbnRJblBlcmlvZChkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsIHsgZXZlbnQsIHBlcmlvZFN0YXJ0LCBwZXJpb2RFbmR9OiBJc0V2ZW50SW5QZXJpb2RBcmdzKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB7IGlzU2FtZVNlY29uZCwgYWRkU2Vjb25kcyB9ID0gZGF0ZUFkYXB0ZXI7XHJcbiAgICBjb25zdCBldmVudFN0YXJ0OiBEYXRlID0gZXZlbnQuc3RhcnQ7XHJcbiAgICBjb25zdCBldmVudEVuZDogRGF0ZSA9IGV2ZW50LmVuZCB8fCBldmVudC5zdGFydDtcclxuXHJcbiAgICBpZiAoZXZlbnRTdGFydCA+IHBlcmlvZFN0YXJ0ICYmIGV2ZW50U3RhcnQgPCBwZXJpb2RFbmQpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXZlbnRFbmQgPiBwZXJpb2RTdGFydCAmJiBldmVudEVuZCA8IHBlcmlvZEVuZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChldmVudFN0YXJ0IDwgcGVyaW9kU3RhcnQgJiYgZXZlbnRFbmQgPiBwZXJpb2RFbmQpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNTYW1lU2Vjb25kKGV2ZW50U3RhcnQsIHBlcmlvZFN0YXJ0KSB8fCBpc1NhbWVTZWNvbmQoZXZlbnRTdGFydCwgcGVyaW9kRW5kKSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc1NhbWVTZWNvbmQoYWRkU2Vjb25kcyhldmVudEVuZCwgLTEpLCBwZXJpb2RTdGFydCkgfHwgaXNTYW1lU2Vjb25kKGFkZFNlY29uZHMoZXZlbnRFbmQsIC0xKSwgcGVyaW9kRW5kKSkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGdldE92ZXJMYXBwaW5nRXZlbnRzKGV2ZW50OiBhbnkvKlNjaGVkdWxlclZpZXdFdmVudCB8IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQqLywgZXZlbnRzOiBTY2hlZHVsZXJWaWV3RXZlbnRbXSwgdG9wOiBudW1iZXIsIGJvdHRvbTogbnVtYmVyLCBsb2dFbmFibGVkOiBib29sZWFuID0gZmFsc2UpOiBTY2hlZHVsZXJWaWV3RXZlbnRbXSB7XHJcbiAgICByZXR1cm4gZXZlbnRzLmZpbHRlcigocHJldmlvdXNFdmVudDogU2NoZWR1bGVyVmlld0V2ZW50KSA9PiB7XHJcbiAgICAgICAgdG9wID0gTWF0aC5yb3VuZCh0b3ApO1xyXG4gICAgICAgIGJvdHRvbSA9IE1hdGgucm91bmQoYm90dG9tKTtcclxuICAgICAgICBjb25zdCBwcmV2aW91c0V2ZW50VG9wOiBudW1iZXIgPSBNYXRoLmZsb29yKHByZXZpb3VzRXZlbnQudG9wKTtcclxuICAgICAgICBjb25zdCBwcmV2aW91c0V2ZW50Qm90dG9tOiBudW1iZXIgPSBNYXRoLmZsb29yKHByZXZpb3VzRXZlbnQudG9wICsgcHJldmlvdXNFdmVudC5oZWlnaHQpO1xyXG5cclxuICAgICAgICBpZiAodG9wIDwgcHJldmlvdXNFdmVudEJvdHRvbSAmJiBwcmV2aW91c0V2ZW50Qm90dG9tIDwgYm90dG9tKSB7XHJcbiAgICAgICAgICAgIGlmIChsb2dFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2dldE92ZXJMYXBwaW5nRXZlbnRzXSAtIEVWRU5UICcgKyAoZXZlbnQuZXZlbnQ/LmlkIHx8IGV2ZW50LmlkKSArICcgLT4gdG9wOiAnICsgdG9wICsgJyAtIGJvdHRvbTogJyArIGJvdHRvbSArICcgfCBQUkVWSU9VUyBFVkVOVCAnICsgcHJldmlvdXNFdmVudC5ldmVudC5pZFxyXG4gICAgICAgICAgICAgICAgICAgICsgJyAtPiBwcmV2aW91c0V2ZW50VG9wOiAnICsgcHJldmlvdXNFdmVudFRvcCArICcgLSBwcmV2aW91c0V2ZW50Qm90dG9tOiAnICsgcHJldmlvdXNFdmVudEJvdHRvbSArICcgLT4gdG9wIDwgcHJldmlvdXNFdmVudEJvdHRvbSAmJiBwcmV2aW91c0V2ZW50Qm90dG9tIDwgYm90dG9tJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b3AgPCBwcmV2aW91c0V2ZW50VG9wICYmIHByZXZpb3VzRXZlbnRUb3AgPCBib3R0b20pIHtcclxuICAgICAgICAgICAgaWYgKGxvZ0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0T3ZlckxhcHBpbmdFdmVudHNdIC0gRVZFTlQgJyArIChldmVudC5ldmVudD8uaWQgfHwgZXZlbnQuaWQpICsgJyAtPiB0b3A6ICcgKyB0b3AgKyAnIC0gYm90dG9tOiAnICsgYm90dG9tICsgJyB8IFBSRVZJT1VTIEVWRU5UICcgKyBwcmV2aW91c0V2ZW50LmV2ZW50LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgKyAnIC0+IHByZXZpb3VzRXZlbnRUb3A6ICcgKyBwcmV2aW91c0V2ZW50VG9wICsgJyAtIHByZXZpb3VzRXZlbnRCb3R0b206ICcgKyBwcmV2aW91c0V2ZW50Qm90dG9tICsgJyAtPiB0b3AgPCBwcmV2aW91c0V2ZW50VG9wICYmIHByZXZpb3VzRXZlbnRUb3AgPCBib3R0b20nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHByZXZpb3VzRXZlbnRUb3AgPD0gdG9wICYmIGJvdHRvbSA8PSBwcmV2aW91c0V2ZW50Qm90dG9tKSB7XHJcbiAgICAgICAgICAgIGlmIChsb2dFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2dldE92ZXJMYXBwaW5nRXZlbnRzXSAtIEVWRU5UICcgKyAoZXZlbnQuZXZlbnQ/LmlkIHx8IGV2ZW50LmlkKSArICcgLT4gdG9wOiAnICsgdG9wICsgJyAtIGJvdHRvbTogJyArIGJvdHRvbSArICcgfCBQUkVWSU9VUyBFVkVOVCAnICsgcHJldmlvdXNFdmVudC5ldmVudC5pZFxyXG4gICAgICAgICAgICAgICAgICAgICsgJyAtPiBwcmV2aW91c0V2ZW50VG9wOiAnICsgcHJldmlvdXNFdmVudFRvcCArICcgLSBwcmV2aW91c0V2ZW50Qm90dG9tOiAnICsgcHJldmlvdXNFdmVudEJvdHRvbSArICcgLT4gcHJldmlvdXNFdmVudFRvcCA8PSB0b3AgJiYgYm90dG9tIDw9IHByZXZpb3VzRXZlbnRCb3R0b20nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gc2FuaXRpc2VIb3Vycyhob3VyczogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbigyMywgaG91cnMpLCAwKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2FuaXRpc2VNaW51dGVzKG1pbnV0ZXM6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4oNTksIG1pbnV0ZXMpLCAwKTtcclxufVxyXG4iXX0=